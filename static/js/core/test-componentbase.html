<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComponentBase Teszt</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #000;
            color: #0f0;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #0f0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0ff;
        }
        #output {
            background: #111;
            padding: 10px;
            margin-top: 10px;
            min-height: 100px;
            border: 1px solid #0f0;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .test-component {
            border: 2px solid #0f0;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ComponentBase Teszt</h1>
    
    <div class="test-section">
        <h2>1. Alapvető komponens teszt</h2>
        <div id="container1"></div>
        <button onclick="testBasic()">Alapvető teszt</button>
        <div id="output1"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Event listener teszt</h2>
        <div id="container2"></div>
        <button onclick="testEvents()">Event teszt</button>
        <div id="output2"></div>
    </div>
    
    <div class="test-section">
        <h2>3. State subscription teszt</h2>
        <div id="container3"></div>
        <button onclick="testState()">State teszt</button>
        <div id="output3"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Destroy/cleanup teszt</h2>
        <div id="container4"></div>
        <button onclick="testDestroy()">Destroy teszt</button>
        <div id="output4"></div>
    </div>
    
    <script type="module">
        import ComponentBase from './ComponentBase.js';
        import eventBus from './EventBus.js';
        import stateManager from './StateManager.js';
        
        window.eventBus = eventBus;
        window.stateManager = stateManager;
        
        // Teszt komponens 1: Alapvető
        class TestComponent1 extends ComponentBase {
            async render() {
                this.container.innerHTML = `
                    <div class="test-component">
                        <h3>Test Component 1</h3>
                        <p>This is a test component</p>
                        <div id="content1">Initial content</div>
                    </div>
                `;
            }
        }
        
        // Teszt komponens 2: Event listener-ekkel
        class TestComponent2 extends ComponentBase {
            async render() {
                this.container.innerHTML = `
                    <div class="test-component">
                        <h3>Test Component 2</h3>
                        <button id="test-btn">Click me!</button>
                        <div id="click-count">Clicks: 0</div>
                    </div>
                `;
            }
            
            attachEventListeners() {
                // Event listener a gombra
                const btn = this.querySelector('#test-btn');
                if (btn) {
                    btn.addEventListener('click', () => {
                        this.emit('test:button:clicked');
                    });
                }
                
                // EventBus listener
                this.onEvent('test:external', (data) => {
                    const countDiv = this.querySelector('#click-count');
                    if (countDiv) {
                        countDiv.textContent = `External event: ${JSON.stringify(data)}`;
                    }
                });
            }
        }
        
        // Teszt komponens 3: State subscription-ökkel
        class TestComponent3 extends ComponentBase {
            async render() {
                const value = this.getState('test:value', 0);
                this.container.innerHTML = `
                    <div class="test-component">
                        <h3>Test Component 3</h3>
                        <div id="state-value">State value: ${value}</div>
                    </div>
                `;
            }
            
            attachStateSubscriptions() {
                this.onStateChange('test:value', (newValue, oldValue) => {
                    const valueDiv = this.querySelector('#state-value');
                    if (valueDiv) {
                        valueDiv.textContent = `State value: ${newValue} (was: ${oldValue})`;
                    }
                });
            }
        }
        
        window.testBasic = async function() {
            const output = document.getElementById('output1');
            const container = document.getElementById('container1');
            output.innerHTML = '';
            
            try {
                const component = new TestComponent1(container);
                await component.init();
                
                output.innerHTML += `<span class="success">✓</span> Komponens inicializálva<br>`;
                output.innerHTML += `<span class="success">✓</span> Container tartalma: ${container.innerHTML.length} karakter<br>`;
                
                // Update teszt
                await component.update({ message: 'Updated!' });
                output.innerHTML += `<span class="success">✓</span> Komponens frissítve<br>`;
                
                // Destroy teszt
                component.destroy();
                output.innerHTML += `<span class="success">✓</span> Komponens megsemmisítve<br>`;
                output.innerHTML += `<span class="success">✓</span> Container üres: ${container.innerHTML === ''}<br>`;
            } catch (error) {
                output.innerHTML += `<span class="error">✗</span> Hiba: ${error.message}<br>`;
            }
        };
        
        window.testEvents = async function() {
            const output = document.getElementById('output2');
            const container = document.getElementById('container2');
            output.innerHTML = '';
            
            try {
                const component = new TestComponent2(container);
                await component.init();
                
                output.innerHTML += `<span class="success">✓</span> Komponens inicializálva<br>`;
                
                // Event listener
                let clickCount = 0;
                component.onEvent('test:button:clicked', () => {
                    clickCount++;
                    output.innerHTML += `[${clickCount}] Button clicked event received<br>`;
                });
                
                // Gomb kattintás szimulálása
                const btn = container.querySelector('#test-btn');
                if (btn) {
                    btn.click();
                    btn.click();
                }
                
                // Külső esemény
                eventBus.emit('test:external', { data: 'Hello from outside!' });
                
                output.innerHTML += `<br>Total clicks: ${clickCount} (should be 2)<br>`;
            } catch (error) {
                output.innerHTML += `<span class="error">✗</span> Hiba: ${error.message}<br>`;
            }
        };
        
        window.testState = async function() {
            const output = document.getElementById('output3');
            const container = document.getElementById('container3');
            output.innerHTML = '';
            
            try {
                const component = new TestComponent3(container);
                await component.init();
                
                output.innerHTML += `<span class="success">✓</span> Komponens inicializálva<br>`;
                
                // State változtatások
                stateManager.setState('test:value', 1);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                stateManager.setState('test:value', 2);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                stateManager.setState('test:value', 3);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                output.innerHTML += `<span class="success">✓</span> State változtatások elküldve<br>`;
                output.innerHTML += `Ellenőrizd a komponens tartalmát!<br>`;
            } catch (error) {
                output.innerHTML += `<span class="error">✗</span> Hiba: ${error.message}<br>`;
            }
        };
        
        window.testDestroy = async function() {
            const output = document.getElementById('output4');
            const container = document.getElementById('container4');
            output.innerHTML = '';
            
            try {
                const component = new TestComponent3(container);
                await component.init();
                
                output.innerHTML += `<span class="success">✓</span> Komponens inicializálva<br>`;
                
                // State subscription hozzáadása
                component.onStateChange('test:value', () => {
                    output.innerHTML += `State changed (should NOT appear after destroy)<br>`;
                });
                
                // Destroy
                component.destroy();
                output.innerHTML += `<span class="success">✓</span> Komponens megsemmisítve<br>`;
                
                // State változtatás (nem kellene meghívódnia)
                stateManager.setState('test:value', 999);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                output.innerHTML += `<span class="success">✓</span> State változtatás után (nem kellene új üzenet)<br>`;
            } catch (error) {
                output.innerHTML += `<span class="error">✗</span> Hiba: ${error.message}<br>`;
            }
        };
    </script>
</body>
</html>

